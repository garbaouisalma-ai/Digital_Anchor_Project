<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-key="page-title">Ø´Ø±Ø§Ø¡ Ø§Ù„Ø­Ø²Ù…Ø© | Ø§Ù„Ù…Ø±Ø³Ø§Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'anchor-blue': '#0f172a',
                        'anchor-gold': '#d4af37',
                        'anchor-green': '#059669'
                    },
                    fontFamily: {
                        sans: ['Tajawal', 'sans-serif']
                    }
                }
            }
        }
    </script>
    
    <script crossorigin src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-slate-50 text-slate-900 font-sans">
    <div id="root" class="flex flex-col min-h-screen w-full"></div>

    <script type="text/babel">
        const { useState, useEffect, createContext, useContext, useMemo } = React;

        // =====================================
        // 1. Ù‚Ø§Ù…ÙˆØ³ Ø§Ù„ØªØ±Ø¬Ù…Ø© (AR Ùˆ EN ÙÙ‚Ø·)
        // =====================================
        // Ù…ÙØ§ØªÙŠØ­ Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø§Ù„Ø®Ø§ØµØ© Ø¨ØµÙØ­Ø© Ø§Ù„Ø´Ø±Ø§Ø¡
        const ALL_TRANSLATIONS = {
            'site-logo': { ar: 'Ø§Ù„Ù…Ø±Ø³Ø§Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©', en: 'Digital Anchor' },
            'nav-home': { ar: 'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©', en: 'Home' },
            'nav-guide': { ar: 'Ø§Ù„Ø¯Ù„ÙŠÙ„', en: 'Guide' },
            'nav-resources': { ar: 'Ø§Ù„Ù…ÙˆØ§Ø±Ø¯', en: 'Resources' },
            'nav-members': { ar: 'Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡', en: 'Members' },
            'nav-buy': { ar: 'Ø§Ø­Ø¬Ø² Ù†Ø³Ø®ØªÙƒ', en: 'Pre-order' },
            'page-title': { ar: 'Ø´Ø±Ø§Ø¡ Ø­Ø²Ù…Ø© Ø§Ù„Ù…Ø±Ø³Ø§Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©', en: 'Purchase the Digital Anchor Package' },
            'page-subtitle': { ar: 'Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„Ø© Ø§Ù„ØªØ­Ø±Ø± Ø§Ù„Ø±Ù‚Ù…ÙŠ Ø§Ù„Ø¢Ù†', en: 'Begin your journey of digital liberation now' },
            'item-ebook': { ar: 'Ø§Ù„ÙƒØªØ§Ø¨ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø§Ù„ÙƒØ§Ù…Ù„', en: 'The Complete E-Book' },
            'item-ebook-desc': { ar: 'Ù†Ø³Ø®Ø© Ø±Ù‚Ù…ÙŠØ© Ø­Ø¯ÙŠØ«Ø©ØŒ Ø³Ù‡Ù„Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©.', en: 'Modern digital version, easy to read on all devices.' },
            'item-print': { ar: 'Ù†Ø³Ø®Ø© ÙˆØ±Ù‚ÙŠØ© (Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø­Ø¬Ø² Ø§Ù„Ù…Ø³Ø¨Ù‚)', en: 'Physical Copy (Pre-order only)' },
            'item-print-desc': { ar: 'ØªØ¬Ø±Ø¨Ø© Ù…Ù„Ù…ÙˆØ³Ø©. Ø³ÙŠØªÙ… Ø´Ø­Ù†Ù‡Ø§ Ø¨Ø¹Ø¯ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø±.', en: 'A tangible experience. Will be shipped after the release date.' },
            'price-note': { ar: 'Ø§Ù„Ø³Ø¹Ø± Ù„Ø§ ÙŠØ´Ù…Ù„ Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ© Ø£Ùˆ ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„Ø´Ø­Ù†.', en: 'Price excludes VAT or shipping costs.' },
            'btn-checkout': { ar: 'Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù„Ù„Ø¯ÙØ¹ Ø§Ù„Ø¢Ù…Ù†', en: 'Proceed to Secure Checkout' },
            'footer-copy': { ar: 'Â© 2025 Ø§Ù„Ù…Ø±Ø³Ø§Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.', en: 'Â© 2025 Digital Anchor. All Rights Reserved.' },
            'price-original': { ar: 'Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£ØµÙ„ÙŠ', en: 'Original Price' },
            'price-preorder': { ar: 'Ø³Ø¹Ø± Ø§Ù„Ø­Ø¬Ø² Ø§Ù„Ù…Ø³Ø¨Ù‚', en: 'Pre-order Price' }
        };

        // =====================================
        // 2. Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø³Ø¹Ø§Ø± Ø§Ù„ØµØ±Ù (SAR, USD, AED, EUR)
        // =====================================
        const EXCHANGE_RATES = {
            'SAR': { rate: 3.75, symbol: 'Ø±.Ø³', placement: 'after' },
            'USD': { rate: 1.0, symbol: '$', placement: 'before' },    
            'AED': { rate: 3.67, symbol: 'Ø¯.Ø¥', placement: 'after' },
            'EUR': { rate: 1.10, symbol: 'â‚¬', placement: 'before' }   
        };
        const SAR_RATE = EXCHANGE_RATES['SAR'].rate; 
        
        // Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø¨Ø§Ù„Ø±ÙŠØ§Ù„ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ (SAR)
        const BASE_PRICE_SAR = 99;
        const ORIGINAL_PRICE_SAR = 149;

        // =====================================
        // 3. Ø§Ù„Ø³ÙŠØ§Ù‚ ÙˆØ§Ù„Ø®Ø·Ø§ÙØ§Øª (Language Provider)
        // =====================================
        const LanguageContext = createContext();

        function useTranslation() {
            return useContext(LanguageContext);
        }

        function LanguageProvider({ children }) {
            const [currentLang, setCurrentLang] = useState(localStorage.getItem('preferredLang') || 'ar');
            const [currentCurrency, setCurrentCurrency] = useState(localStorage.getItem('preferredCurrency') || 'SAR');

            useEffect(() => {
                localStorage.setItem('preferredLang', currentLang);
                document.documentElement.setAttribute('dir', currentLang === 'ar' ? 'rtl' : 'ltr');
                document.documentElement.setAttribute('lang', currentLang);
                
                const titleKey = document.head.querySelector('title')?.getAttribute('data-key') || 'page-title';
                document.title = ALL_TRANSLATIONS[titleKey]?.[currentLang] || ALL_TRANSLATIONS[titleKey]?.['ar'] || 'Buy Page';
            }, [currentLang]);

            const t = useMemo(() => (key) => {
                return ALL_TRANSLATIONS[key]?.[currentLang] || ALL_TRANSLATIONS[key]?.['ar'] || `[${key}]`;
            }, [currentLang]);

            const convertPrice = (basePriceSAR) => {
                const target = EXCHANGE_RATES[currentCurrency];
                if (!target || isNaN(basePriceSAR)) return `${basePriceSAR} SAR`;

                const priceInUSD = basePriceSAR / SAR_RATE;
                
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ù†Ø²Ù„ØªÙŠÙ† Ø¹Ø´Ø±ÙŠØªÙŠÙ† Ù„Ù„ÙŠÙˆØ±Ùˆ ÙˆØ§Ù„Ø¯ÙˆÙ„Ø§Ø±ØŒ ÙˆØµÙØ± Ù„Ù„Ù…Ø­Ù„ÙŠ
                const decimalPlaces = (currentCurrency === 'SAR' || currentCurrency === 'AED') ? 0 : 2;
                const newPrice = (priceInUSD * target.rate).toFixed(decimalPlaces); 
                
                const symbol = target.symbol;
                
                return target.placement === 'before' ? `${symbol}${newPrice}` : `${newPrice} ${symbol}`;
            };

            const setCurrency = (currencyCode) => {
                setCurrentCurrency(currencyCode);
                localStorage.setItem('preferredCurrency', currencyCode);
            };

            const contextValue = {
                t,
                currentLang,
                setLang: setCurrentLang,
                currentCurrency,
                setCurrency,
                convertPrice,
                EXCHANGE_RATES,
                SAR_RATE
            };

            return (
                <LanguageContext.Provider value={contextValue}>
                    {children}
                </LanguageContext.Provider>
            );
        }


        // =====================================
        // 4. Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„ØµÙØ­Ø© (Ù…Ø¹ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ±Ø¬Ù…Ø©)
        // =====================================
        
        // ğŸš€ ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù€ NavBar Ù„ÙŠØ¯Ø¹Ù… Ø§Ù„Ø¹Ù…Ù„Ø§Øª ÙˆØ§Ù„Ù„ØºØ§Øª
        const NavBar = () => {
            const { t, setLang, currentLang, currentCurrency, setCurrency, EXCHANGE_RATES } = useTranslation();
            
            const availableLangs = ['ar', 'en'];
            
            return (
                <nav className="bg-anchor-blue text-white py-4 px-6 sticky top-0 z-50 shadow-lg">
                    <div className="max-w-7xl mx-auto flex justify-between items-center">
                        <a href="index.html" className="flex items-center gap-3 group">
                            <div className="w-10 h-10 bg-gradient-to-r from-anchor-gold to-yellow-500 rounded-lg flex items-center justify-center">
                                <i className="fas fa-anchor text-anchor-blue text-lg"></i>
                            </div>
                            <div>
                                <span className="font-bold text-lg hidden md:block">{t('site-logo')}</span>
                            </div>
                        </a>
                        
                        <div className="flex gap-4 md:gap-6 text-sm font-medium items-center">
                            {/* ğŸŒ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù„ØºØ© (AR/EN ÙÙ‚Ø·) ğŸŒ */}
                            <div className="flex items-center space-x-1 border border-gray-600 rounded-full p-1">
                                {availableLangs.map(lang => (
                                    <button 
                                        key={lang}
                                        onClick={() => setLang(lang)} 
                                        className={`text-sm font-bold px-3 py-1 rounded-full 
                                            ${currentLang === lang ? 'bg-white text-anchor-blue' : 'text-gray-300 hover:bg-gray-700'} transition`}
                                    >
                                        {lang === 'ar' ? 'Ø¹' : 'En'}
                                    </button>
                                ))}
                            </div>
                            
                            {/* ğŸ’µ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø© (SAR, USD, AED, EUR) ğŸ’µ */}
                            <select 
                                value={currentCurrency} 
                                onChange={(e) => setCurrency(e.target.value)}
                                className="text-anchor-blue font-medium border border-gray-300 rounded-lg p-2 transition"
                            >
                                {Object.keys(EXCHANGE_RATES).map(code => (
                                    <option key={code} value={code}>
                                        {EXCHANGE_RATES[code].symbol} ({code})
                                    </option>
                                ))}
                            </select>

                            <a href="index.html" className="hover:text-anchor-gold transition">{t('nav-home')}</a>
                            <a href="book-preorder.html" className="bg-anchor-gold text-anchor-blue px-5 py-2.5 rounded-full font-bold hover:bg-yellow-400 transition shadow-lg">
                                {t('nav-buy')}
                            </a>
                        </div>
                    </div>
                </nav>
            );
        };

        const BuyPage = () => {
            const { t, convertPrice } = useTranslation();
            const [orderSent, setOrderSent] = React.useState(false);
            
            // Note: The actual payment logic is handled by the form action
            const handleSubmit = (e) => {
                e.preventDefault();
                // Ù‡Ù†Ø§ Ù‚Ø¯ ØªØ¶Ø¹ÙŠÙ† Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØ­Ù‚Ù‚ Ù‚Ø¨Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹
                window.location.href = 'thank-you-preorder.html'; // ØªØ­ÙˆÙŠÙ„ Ù…Ø¤Ù‚Øª
            };

            return (
                <div className="flex flex-col min-h-screen">
                    <NavBar />

                    <main className="flex-grow container mx-auto px-4 py-12 max-w-4xl">
                        <header className="text-center mb-10">
                            <h1 className="text-4xl font-extrabold text-anchor-blue mb-2">{t('page-title')}</h1>
                            <p className="text-xl text-gray-600">{t('page-subtitle')}</p>
                        </header>

                        <div className="bg-white p-8 md:p-10 rounded-xl shadow-2xl border-t-4 border-anchor-gold">
                            
                            {/* Product Details */}
                            <div className="text-center mb-8">
                                <h2 className="text-3xl font-bold text-anchor-blue mb-4">{t('item-ebook')}</h2>
                                <p className="text-gray-500 mb-6">{t('item-ebook-desc')}</p>
                                
                                {/* Pricing Section - Uses convertPrice() */}
                                <div className="flex flex-col items-center justify-center space-y-2 mb-6">
                                    <div className="text-sm text-gray-400 line-through">
                                        {t('price-original')}: {convertPrice(ORIGINAL_PRICE_SAR)}
                                    </div>
                                    <div className="text-2xl font-semibold text-anchor-gold">
                                        {t('price-preorder')}:
                                    </div>
                                    <div className="text-6xl font-extrabold text-red-600">
                                        {convertPrice(BASE_PRICE_SAR)}
                                    </div>
                                </div>
                                
                                <div className="flex flex-col gap-3 justify-center text-left text-sm text-gray-600 border-t pt-4">
                                    <p className="flex items-start">
                                        <i className="fas fa-check-circle text-anchor-green ml-2 mt-1"></i>
                                        {t('item-ebook-desc')}
                                    </p>
                                    <p className="flex items-start">
                                        <i className="fas fa-file-contract text-anchor-gold ml-2 mt-1"></i>
                                        {t('item-print-desc')}
                                    </p>
                                </div>
                            </div>
                            
                            {/* Checkout Button */}
                            <form onSubmit={handleSubmit} className="mt-8">
                                <p className="text-center text-sm text-gray-400 mb-4">{t('price-note')}</p>
                                <button
                                    type="submit"
                                    className="w-full bg-anchor-green text-white py-3 rounded-lg font-bold text-xl hover:bg-green-600 transition shadow-lg"
                                >
                                    {t('btn-checkout')}
                                </button>
                            </form>
                        </div>
                    </main>

                    <footer className="bg-anchor-blue text-slate-400 py-8 text-center">
                        <div className="max-w-4xl mx-auto px-6">
                            <hr className="border-slate-700 mb-6"/>
                            <p className="text-sm">
                                {t('footer-copy')}
                            </p>
                        </div>
                    </footer>
                </div>
            );
        };

        // âœ… Ø§Ù„ØªØµÙŠÙŠØ± Ø§Ù„ØµØ­ÙŠØ­
        // Ø¨Ù…Ø§ Ø£Ù† Ù…Ù„ÙÙƒ Ø§Ù„Ø£ØµÙ„ÙŠ Ø§Ø³ØªØ®Ø¯Ù… ReactDOM.renderØŒ Ø³Ù†Ø³ØªØ®Ø¯Ù… ReactDOM.createRoot Ø¥Ø°Ø§ ÙƒØ§Ù† React 18 Ù…ØªØ§Ø­Ø§Ù‹
        // (ÙˆÙ‡Ùˆ Ù…ØªÙˆÙØ± Ø­Ø³Ø¨ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· ÙÙŠ Ø±Ø£Ø³ Ø§Ù„Ù…Ù„Ù)
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<LanguageProvider><BuyPage /></LanguageProvider>);
    </script>
</body>
</html>